{"remainingRequest":"F:\\A---Spring\\bladeX\\blade\\Saber\\node_modules\\babel-loader\\lib\\index.js!F:\\A---Spring\\bladeX\\blade\\Saber\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!F:\\A---Spring\\bladeX\\blade\\Saber\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\A---Spring\\bladeX\\blade\\Saber\\node_modules\\avue-plugin-ueditor\\packages\\ueditor\\src\\main.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\A---Spring\\bladeX\\blade\\Saber\\node_modules\\avue-plugin-ueditor\\packages\\ueditor\\src\\main.vue","mtime":1599805888000},{"path":"F:\\A---Spring\\bladeX\\blade\\Saber\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\A---Spring\\bladeX\\blade\\Saber\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"F:\\A---Spring\\bladeX\\blade\\Saber\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\A---Spring\\bladeX\\blade\\Saber\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.index-of\";\nimport \"core-js/modules/es6.function.name\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { getClient } from \"./upload/ali\";\nimport { getToken } from \"./upload/qiniu\";\nimport { getObjValue, HTMLFormat } from \"./upload/util\";\nimport E from 'wangeditor';\nexport default {\n  name: \"AvueUeditor\",\n  computed: {\n    domId: function domId() {\n      return '#' + this.id;\n    },\n    imgFlag: function imgFlag() {\n      return this.img.url == '';\n    },\n    isImg: function isImg() {\n      return this.img.obj.src;\n    },\n    urlKey: function urlKey() {\n      return this.props.url || 'url';\n    },\n    props: function props() {\n      return this.options.props || {};\n    },\n    oss: function oss() {\n      return this.options.oss;\n    },\n    customConfig: function customConfig() {\n      return this.options.customConfig || {};\n    },\n    action: function action() {\n      return this.options.action;\n    },\n    qiniu: function qiniu() {\n      return this.options.qiniu;\n    },\n    ali: function ali() {\n      return this.options.ali;\n    },\n    isQiniuOSS: function isQiniuOSS() {\n      return this.oss === \"qiniu\";\n    },\n    isAliOSS: function isAliOSS() {\n      return this.oss === \"ali\";\n    },\n    headers: function headers() {\n      return this.options.headers || {};\n    }\n  },\n  props: {\n    options: {\n      type: Object,\n      default: function _default() {\n        return {};\n      }\n    },\n    id: {\n      type: String,\n      default: function _default() {\n        return 'avue-ueditor-' + Math.ceil(Math.random() * 100);\n      }\n    },\n    disabled: {\n      type: Boolean,\n      default: false\n    },\n    value: {\n      type: String,\n      default: \"\"\n    }\n  },\n  data: function data() {\n    return {\n      textall: '',\n      text: '',\n      dialogVisible: false,\n      editor: ''\n    };\n  },\n  watch: {\n    disabled: function disabled(val) {\n      this.editor.$textElem.attr('contenteditable', !val);\n    },\n    value: function value(newVal) {\n      if (this.editor) {\n        if (newVal && newVal !== this.text) {\n          this.text = newVal;\n          this.editor.txt.html(newVal);\n        } else if (!newVal) {\n          this.text = '';\n          this.editor.txt.html('');\n        }\n      }\n    }\n  },\n  mounted: function mounted() {\n    this.initEdit();\n  },\n  methods: {\n    initEdit: function initEdit() {\n      var _this = this;\n\n      this.editor = new E(this.domId);\n      window.wangEditor = E;\n      this.editor.customConfig.zIndex = 100;\n\n      this.editor.customConfig.onfocus = function () {\n        _this.$emit('focus', _this.text);\n      };\n\n      this.editor.customConfig.onblur = function (html) {\n        _this.$emit('blur', html);\n      };\n\n      this.editor.customConfig.onchange = function (html) {\n        _this.text = html;\n\n        _this.$emit('input', _this.text);\n      };\n\n      this.editor.customConfig = Object.assign(this.editor.customConfig, this.customConfig);\n      this.initUploadImg();\n      this.editor.create();\n      this.initPlugins();\n\n      if (this.disabled) {\n        this.editor.$textElem.attr('contenteditable', false);\n      }\n\n      this.editor.txt.html(this.value); // 去掉文件粘贴自动上传，如果是复制的网页图片是不会生成两个img标签，粘贴事件不识别是否是网络图片，都会已文件的方式上传，导致bug\n      // this.handlePaste();\n    },\n    initUploadImg: function initUploadImg() {\n      var _this2 = this;\n\n      this.editor.customConfig.customUploadImg = function (file, insert) {\n        _this2.uploadFile(file[0]).then(function (res) {\n          insert(res);\n        });\n      };\n    },\n    uploadFile: function uploadFile(file) {\n      var _this3 = this;\n\n      return new Promise(function (resolve, reject) {\n        var loading = _this3.$loading({\n          lock: true,\n          text: 'Loading',\n          spinner: 'el-icon-loading',\n          background: 'rgba(0, 0, 0, 0.7)',\n          // 只在输入框里面弹起loading，全屏loading很影响用户体验\n          target: \"\".concat(_this3.domId)\n        });\n\n        var headers = Object.assign(_this3.headers, {\n          \"Content-Type\": \"multipart/form-data\"\n        });\n        var oss_config = {};\n        var client;\n        var param = new FormData();\n        var url = _this3.action;\n        param.append(\"file\", file);\n\n        if (_this3.isQiniuOSS) {\n          oss_config = _this3.qiniu;\n          var token = getToken(oss_config.AK, oss_config.SK, {\n            scope: oss_config.scope,\n            deadline: new Date().getTime() + oss_config.deadline * 3600\n          });\n          param.append(\"token\", token);\n          url = \"http://up.qiniu.com/\";\n        } else if (_this3.isAliOSS) {\n          oss_config = _this3.ali;\n          client = getClient({\n            region: oss_config.region,\n            endpoint: oss_config.endpoint,\n            accessKeyId: oss_config.accessKeyId,\n            accessKeySecret: oss_config.accessKeySecret,\n            bucket: oss_config.bucket\n          });\n        }\n\n        (function () {\n          if (_this3.isAliOSS) {\n            return client.put(file.name, file);\n          } else {\n            return _this3.$axios.post(url, param, {\n              headers: headers\n            });\n          }\n        })().then(function (res) {\n          var list = {};\n          var result = '';\n\n          if (_this3.isAliOSS) {\n            list = res;\n            result = list.url;\n          } else if (_this3.isQiniuOSS) {\n            list = res.data;\n            list.key = oss_config.url + list.key;\n            result = list.key;\n          } else {\n            list = getObjValue(res.data, _this3.props.res, \"object\");\n            result = list[_this3.urlKey];\n          }\n\n          var html = result;\n          loading.close();\n          resolve(html);\n        }).catch(function (err) {\n          loading.close();\n          reject(err);\n        });\n      });\n    },\n    handleClose: function handleClose(done) {\n      this.$emit('input', HTMLFormat(this.textall));\n      done();\n    },\n    getUEContent: function getUEContent() {\n      return this.editor.txt.html();\n    },\n    HTMLFormat: HTMLFormat,\n    handlePaste: function handlePaste() {\n      var _this4 = this;\n\n      //粘贴键\n      document.addEventListener(\"paste\", function (e) {\n        //获取剪切板文件\n        var getFile = function getFile(event) {\n          if (event.clipboardData || event.originalEvent) {\n            var clipboardData = event.clipboardData || event.originalEvent.clipboardData;\n\n            if (clipboardData.items) {\n              var items = clipboardData.items,\n                  len = items.length,\n                  blob = null;\n\n              for (var i = 0; i < len; i++) {\n                if (items[i].type.indexOf(\"image\") !== -1) {\n                  blob = items[i].getAsFile();\n                  return blob;\n                }\n              }\n            }\n          }\n        };\n\n        var file = getFile(e);\n\n        if (file) {\n          _this4.uploadFile(file).then(function (res) {\n            _this4.editor.txt.append('<img src=\"' + res + '\" />');\n          });\n        }\n      });\n    },\n    initPlugins: function initPlugins() {\n      var _this5 = this;\n\n      E.fullscreen = {\n        // editor create之后调用\n        init: function init(editorSelector) {\n          setTimeout(function () {\n            document.querySelector(editorSelector + \" .w-e-toolbar\").appendHTML('<div class=\"w-e-menu\"><span class=\"_wangEditor_btn_fullscreen\" href=\"###\" onclick=\"window.wangEditor.fullscreen.toggleFullscreen(\\'' + editorSelector + '\\')\">全屏</span></div>');\n          }, 0);\n        },\n        toggleFullscreen: function toggleFullscreen(editorSelector) {\n          document.querySelector(editorSelector).toggleClass('fullscreen-editor');\n\n          if (document.querySelector(editorSelector + ' ._wangEditor_btn_fullscreen').innerText == '全屏') {\n            document.querySelector(editorSelector + ' ._wangEditor_btn_fullscreen').innerText = '退出全屏';\n          } else {\n            document.querySelector(editorSelector + ' ._wangEditor_btn_fullscreen').innerText = '全屏';\n          }\n        }\n      };\n      E.fullscreen.init(this.domId);\n      E.views = {\n        init: function init(editorSelector) {\n          document.querySelector(editorSelector + \" .w-e-toolbar\").appendHTML('<div class=\"w-e-menu\"><span class=\"_wangEditor_btn_fullscreen\" href=\"###\" onclick=\"window.wangEditor.views.toggleFullscreen(\\'' + editorSelector + '\\')\">源代码</span></div>');\n        },\n        toggleFullscreen: function toggleFullscreen() {\n          _this5.textall = HTMLFormat(_this5.value);\n          _this5.dialogVisible = true;\n        }\n      };\n      E.views.init(this.domId);\n    }\n  }\n};",{"version":3,"sources":["main.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAgBA,SAAA,SAAA;AACA,SAAA,QAAA;AACA,SAAA,WAAA,EAAA,UAAA;AACA,OAAA,CAAA,MAAA,YAAA;AACA,eAAA;AACA,EAAA,IAAA,EAAA,aADA;AAEA,EAAA,QAAA,EAAA;AACA,IAAA,KADA,mBACA;AACA,aAAA,MAAA,KAAA,EAAA;AACA,KAHA;AAIA,IAAA,OAJA,qBAIA;AACA,aAAA,KAAA,GAAA,CAAA,GAAA,IAAA,EAAA;AACA,KANA;AAOA,IAAA,KAPA,mBAOA;AACA,aAAA,KAAA,GAAA,CAAA,GAAA,CAAA,GAAA;AACA,KATA;AAUA,IAAA,MAVA,oBAUA;AACA,aAAA,KAAA,KAAA,CAAA,GAAA,IAAA,KAAA;AACA,KAZA;AAaA,IAAA,KAbA,mBAaA;AACA,aAAA,KAAA,OAAA,CAAA,KAAA,IAAA,EAAA;AACA,KAfA;AAgBA,IAAA,GAhBA,iBAgBA;AACA,aAAA,KAAA,OAAA,CAAA,GAAA;AACA,KAlBA;AAmBA,IAAA,YAnBA,0BAmBA;AACA,aAAA,KAAA,OAAA,CAAA,YAAA,IAAA,EAAA;AACA,KArBA;AAsBA,IAAA,MAtBA,oBAsBA;AACA,aAAA,KAAA,OAAA,CAAA,MAAA;AACA,KAxBA;AAyBA,IAAA,KAzBA,mBAyBA;AACA,aAAA,KAAA,OAAA,CAAA,KAAA;AACA,KA3BA;AA4BA,IAAA,GA5BA,iBA4BA;AACA,aAAA,KAAA,OAAA,CAAA,GAAA;AACA,KA9BA;AA+BA,IAAA,UA/BA,wBA+BA;AACA,aAAA,KAAA,GAAA,KAAA,OAAA;AACA,KAjCA;AAkCA,IAAA,QAlCA,sBAkCA;AACA,aAAA,KAAA,GAAA,KAAA,KAAA;AACA,KApCA;AAqCA,IAAA,OArCA,qBAqCA;AACA,aAAA,KAAA,OAAA,CAAA,OAAA,IAAA,EAAA;AACA;AAvCA,GAFA;AA2CA,EAAA,KAAA,EAAA;AACA,IAAA,OAAA,EAAA;AACA,MAAA,IAAA,EAAA,MADA;AAEA,MAAA,OAAA,EAAA,oBAAA;AACA,eAAA,EAAA;AACA;AAJA,KADA;AAOA,IAAA,EAAA,EAAA;AACA,MAAA,IAAA,EAAA,MADA;AAEA,MAAA,OAAA,EAAA,oBAAA;AACA,eAAA,kBAAA,IAAA,CAAA,IAAA,CAAA,IAAA,CAAA,MAAA,KAAA,GAAA,CAAA;AACA;AAJA,KAPA;AAaA,IAAA,QAAA,EAAA;AACA,MAAA,IAAA,EAAA,OADA;AAEA,MAAA,OAAA,EAAA;AAFA,KAbA;AAiBA,IAAA,KAAA,EAAA;AACA,MAAA,IAAA,EAAA,MADA;AAEA,MAAA,OAAA,EAAA;AAFA;AAjBA,GA3CA;AAiEA,EAAA,IAjEA,kBAiEA;AACA,WAAA;AACA,MAAA,OAAA,EAAA,EADA;AAEA,MAAA,IAAA,EAAA,EAFA;AAGA,MAAA,aAAA,EAAA,KAHA;AAIA,MAAA,MAAA,EAAA;AAJA,KAAA;AAMA,GAxEA;AAyEA,EAAA,KAAA,EAAA;AACA,IAAA,QADA,oBACA,GADA,EACA;AACA,WAAA,MAAA,CAAA,SAAA,CAAA,IAAA,CAAA,iBAAA,EAAA,CAAA,GAAA;AACA,KAHA;AAIA,IAAA,KAJA,iBAIA,MAJA,EAIA;AACA,UAAA,KAAA,MAAA,EAAA;AACA,YAAA,MAAA,IAAA,MAAA,KAAA,KAAA,IAAA,EAAA;AACA,eAAA,IAAA,GAAA,MAAA;AACA,eAAA,MAAA,CAAA,GAAA,CAAA,IAAA,CAAA,MAAA;AACA,SAHA,MAGA,IAAA,CAAA,MAAA,EAAA;AACA,eAAA,IAAA,GAAA,EAAA;AACA,eAAA,MAAA,CAAA,GAAA,CAAA,IAAA,CAAA,EAAA;AACA;AACA;AACA;AAdA,GAzEA;AAyFA,EAAA,OAzFA,qBAyFA;AACA,SAAA,QAAA;AACA,GA3FA;AA4FA,EAAA,OAAA,EAAA;AACA,IAAA,QADA,sBACA;AAAA;;AACA,WAAA,MAAA,GAAA,IAAA,CAAA,CAAA,KAAA,KAAA,CAAA;AACA,MAAA,MAAA,CAAA,UAAA,GAAA,CAAA;AACA,WAAA,MAAA,CAAA,YAAA,CAAA,MAAA,GAAA,GAAA;;AACA,WAAA,MAAA,CAAA,YAAA,CAAA,OAAA,GAAA,YAAA;AACA,QAAA,KAAA,CAAA,KAAA,CAAA,OAAA,EAAA,KAAA,CAAA,IAAA;AACA,OAFA;;AAGA,WAAA,MAAA,CAAA,YAAA,CAAA,MAAA,GAAA,UAAA,IAAA,EAAA;AACA,QAAA,KAAA,CAAA,KAAA,CAAA,MAAA,EAAA,IAAA;AACA,OAFA;;AAGA,WAAA,MAAA,CAAA,YAAA,CAAA,QAAA,GAAA,UAAA,IAAA,EAAA;AACA,QAAA,KAAA,CAAA,IAAA,GAAA,IAAA;;AACA,QAAA,KAAA,CAAA,KAAA,CAAA,OAAA,EAAA,KAAA,CAAA,IAAA;AACA,OAHA;;AAIA,WAAA,MAAA,CAAA,YAAA,GAAA,MAAA,CAAA,MAAA,CAAA,KAAA,MAAA,CAAA,YAAA,EAAA,KAAA,YAAA,CAAA;AACA,WAAA,aAAA;AACA,WAAA,MAAA,CAAA,MAAA;AACA,WAAA,WAAA;;AACA,UAAA,KAAA,QAAA,EAAA;AACA,aAAA,MAAA,CAAA,SAAA,CAAA,IAAA,CAAA,iBAAA,EAAA,KAAA;AACA;;AACA,WAAA,MAAA,CAAA,GAAA,CAAA,IAAA,CAAA,KAAA,KAAA,EArBA,CAsBA;AACA;AACA,KAzBA;AA0BA,IAAA,aA1BA,2BA0BA;AAAA;;AACA,WAAA,MAAA,CAAA,YAAA,CAAA,eAAA,GAAA,UAAA,IAAA,EAAA,MAAA,EAAA;AACA,QAAA,MAAA,CAAA,UAAA,CAAA,IAAA,CAAA,CAAA,CAAA,EAAA,IAAA,CAAA,UAAA,GAAA,EAAA;AACA,UAAA,MAAA,CAAA,GAAA,CAAA;AACA,SAFA;AAGA,OAJA;AAKA,KAhCA;AAiCA,IAAA,UAjCA,sBAiCA,IAjCA,EAiCA;AAAA;;AACA,aAAA,IAAA,OAAA,CAAA,UAAA,OAAA,EAAA,MAAA,EAAA;AACA,YAAA,OAAA,GAAA,MAAA,CAAA,QAAA,CAAA;AACA,UAAA,IAAA,EAAA,IADA;AAEA,UAAA,IAAA,EAAA,SAFA;AAGA,UAAA,OAAA,EAAA,iBAHA;AAIA,UAAA,UAAA,EAAA,oBAJA;AAKA;AACA,UAAA,MAAA,YAAA,MAAA,CAAA,KAAA;AANA,SAAA,CAAA;;AASA,YAAA,OAAA,GAAA,MAAA,CAAA,MAAA,CAAA,MAAA,CAAA,OAAA,EAAA;AAAA,0BAAA;AAAA,SAAA,CAAA;AACA,YAAA,UAAA,GAAA,EAAA;AACA,YAAA,MAAA;AACA,YAAA,KAAA,GAAA,IAAA,QAAA,EAAA;AACA,YAAA,GAAA,GAAA,MAAA,CAAA,MAAA;AACA,QAAA,KAAA,CAAA,MAAA,CAAA,MAAA,EAAA,IAAA;;AACA,YAAA,MAAA,CAAA,UAAA,EAAA;AACA,UAAA,UAAA,GAAA,MAAA,CAAA,KAAA;AACA,cAAA,KAAA,GAAA,QAAA,CAAA,UAAA,CAAA,EAAA,EAAA,UAAA,CAAA,EAAA,EAAA;AACA,YAAA,KAAA,EAAA,UAAA,CAAA,KADA;AAEA,YAAA,QAAA,EAAA,IAAA,IAAA,GAAA,OAAA,KAAA,UAAA,CAAA,QAAA,GAAA;AAFA,WAAA,CAAA;AAIA,UAAA,KAAA,CAAA,MAAA,CAAA,OAAA,EAAA,KAAA;AACA,UAAA,GAAA,GAAA,sBAAA;AACA,SARA,MAQA,IAAA,MAAA,CAAA,QAAA,EAAA;AACA,UAAA,UAAA,GAAA,MAAA,CAAA,GAAA;AACA,UAAA,MAAA,GAAA,SAAA,CAAA;AACA,YAAA,MAAA,EAAA,UAAA,CAAA,MADA;AAEA,YAAA,QAAA,EAAA,UAAA,CAAA,QAFA;AAGA,YAAA,WAAA,EAAA,UAAA,CAAA,WAHA;AAIA,YAAA,eAAA,EAAA,UAAA,CAAA,eAJA;AAKA,YAAA,MAAA,EAAA,UAAA,CAAA;AALA,WAAA,CAAA;AAOA;;AACA,SAAA,YAAA;AACA,cAAA,MAAA,CAAA,QAAA,EAAA;AACA,mBAAA,MAAA,CAAA,GAAA,CAAA,IAAA,CAAA,IAAA,EAAA,IAAA,CAAA;AACA,WAFA,MAEA;AACA,mBAAA,MAAA,CAAA,MAAA,CAAA,IAAA,CAAA,GAAA,EAAA,KAAA,EAAA;AAAA,cAAA,OAAA,EAAA;AAAA,aAAA,CAAA;AACA;AACA,SANA,IAMA,IANA,CAMA,UAAA,GAAA,EAAA;AACA,cAAA,IAAA,GAAA,EAAA;AACA,cAAA,MAAA,GAAA,EAAA;;AACA,cAAA,MAAA,CAAA,QAAA,EAAA;AACA,YAAA,IAAA,GAAA,GAAA;AACA,YAAA,MAAA,GAAA,IAAA,CAAA,GAAA;AACA,WAHA,MAGA,IAAA,MAAA,CAAA,UAAA,EAAA;AACA,YAAA,IAAA,GAAA,GAAA,CAAA,IAAA;AACA,YAAA,IAAA,CAAA,GAAA,GAAA,UAAA,CAAA,GAAA,GAAA,IAAA,CAAA,GAAA;AACA,YAAA,MAAA,GAAA,IAAA,CAAA,GAAA;AACA,WAJA,MAIA;AACA,YAAA,IAAA,GAAA,WAAA,CAAA,GAAA,CAAA,IAAA,EAAA,MAAA,CAAA,KAAA,CAAA,GAAA,EAAA,QAAA,CAAA;AACA,YAAA,MAAA,GAAA,IAAA,CAAA,MAAA,CAAA,MAAA,CAAA;AACA;;AACA,cAAA,IAAA,GAAA,MAAA;AACA,UAAA,OAAA,CAAA,KAAA;AACA,UAAA,OAAA,CAAA,IAAA,CAAA;AACA,SAvBA,EAuBA,KAvBA,CAuBA,UAAA,GAAA,EAAA;AACA,UAAA,OAAA,CAAA,KAAA;AACA,UAAA,MAAA,CAAA,GAAA,CAAA;AACA,SA1BA;AA2BA,OA7DA,CAAA;AA+DA,KAjGA;AAkGA,IAAA,WAlGA,uBAkGA,IAlGA,EAkGA;AACA,WAAA,KAAA,CAAA,OAAA,EAAA,UAAA,CAAA,KAAA,OAAA,CAAA;AACA,MAAA,IAAA;AACA,KArGA;AAsGA,IAAA,YAtGA,0BAsGA;AACA,aAAA,KAAA,MAAA,CAAA,GAAA,CAAA,IAAA,EAAA;AACA,KAxGA;AAyGA,IAAA,UAAA,EAAA,UAzGA;AA0GA,IAAA,WA1GA,yBA0GA;AAAA;;AACA;AACA,MAAA,QAAA,CAAA,gBAAA,CAAA,OAAA,EAAA,UAAA,CAAA,EAAA;AACA;AACA,YAAA,OAAA,GAAA,SAAA,OAAA,CAAA,KAAA,EAAA;AACA,cAAA,KAAA,CAAA,aAAA,IAAA,KAAA,CAAA,aAAA,EAAA;AACA,gBAAA,aAAA,GACA,KAAA,CAAA,aAAA,IAAA,KAAA,CAAA,aAAA,CAAA,aADA;;AAEA,gBAAA,aAAA,CAAA,KAAA,EAAA;AACA,kBAAA,KAAA,GAAA,aAAA,CAAA,KAAA;AAAA,kBACA,GAAA,GAAA,KAAA,CAAA,MADA;AAAA,kBAEA,IAAA,GAAA,IAFA;;AAGA,mBAAA,IAAA,CAAA,GAAA,CAAA,EAAA,CAAA,GAAA,GAAA,EAAA,CAAA,EAAA,EAAA;AACA,oBAAA,KAAA,CAAA,CAAA,CAAA,CAAA,IAAA,CAAA,OAAA,CAAA,OAAA,MAAA,CAAA,CAAA,EAAA;AACA,kBAAA,IAAA,GAAA,KAAA,CAAA,CAAA,CAAA,CAAA,SAAA,EAAA;AACA,yBAAA,IAAA;AACA;AACA;AACA;AACA;AACA,SAhBA;;AAiBA,YAAA,IAAA,GAAA,OAAA,CAAA,CAAA,CAAA;;AACA,YAAA,IAAA,EAAA;AACA,UAAA,MAAA,CAAA,UAAA,CAAA,IAAA,EAAA,IAAA,CAAA,UAAA,GAAA,EAAA;AACA,YAAA,MAAA,CAAA,MAAA,CAAA,GAAA,CAAA,MAAA,CAAA,eAAA,GAAA,GAAA,MAAA;AACA,WAFA;AAGA;AACA,OAzBA;AA0BA,KAtIA;AAuIA,IAAA,WAvIA,yBAuIA;AAAA;;AACA,MAAA,CAAA,CAAA,UAAA,GAAA;AACA;AACA,QAAA,IAAA,EAAA,cAAA,cAAA,EAAA;AACA,UAAA,UAAA,CAAA,YAAA;AACA,YAAA,QAAA,CAAA,aAAA,CAAA,cAAA,GAAA,eAAA,EAAA,UAAA,CAAA,wIAAA,cAAA,GAAA,sBAAA;AACA,WAFA,EAEA,CAFA,CAAA;AAGA,SANA;AAOA,QAAA,gBAAA,EAAA,0BAAA,cAAA,EAAA;AACA,UAAA,QAAA,CAAA,aAAA,CAAA,cAAA,EAAA,WAAA,CAAA,mBAAA;;AACA,cAAA,QAAA,CAAA,aAAA,CAAA,cAAA,GAAA,8BAAA,EAAA,SAAA,IAAA,IAAA,EAAA;AACA,YAAA,QAAA,CAAA,aAAA,CAAA,cAAA,GAAA,8BAAA,EAAA,SAAA,GAAA,MAAA;AACA,WAFA,MAEA;AACA,YAAA,QAAA,CAAA,aAAA,CAAA,cAAA,GAAA,8BAAA,EAAA,SAAA,GAAA,IAAA;AACA;AACA;AAdA,OAAA;AAgBA,MAAA,CAAA,CAAA,UAAA,CAAA,IAAA,CAAA,KAAA,KAAA;AACA,MAAA,CAAA,CAAA,KAAA,GAAA;AACA,QAAA,IAAA,EAAA,cAAA,cAAA,EAAA;AACA,UAAA,QAAA,CAAA,aAAA,CAAA,cAAA,GAAA,eAAA,EAAA,UAAA,CAAA,mIAAA,cAAA,GAAA,uBAAA;AACA,SAHA;AAIA,QAAA,gBAAA,EAAA,4BAAA;AACA,UAAA,MAAA,CAAA,OAAA,GAAA,UAAA,CAAA,MAAA,CAAA,KAAA,CAAA;AACA,UAAA,MAAA,CAAA,aAAA,GAAA,IAAA;AACA;AAPA,OAAA;AASA,MAAA,CAAA,CAAA,KAAA,CAAA,IAAA,CAAA,KAAA,KAAA;AACA;AAnKA;AA5FA,CAAA","sourcesContent":["<template>\n  <div class=\"avue-ueditor\">\n    <div :id=\"id\"></div>\n    <el-dialog title=\"源代码编辑\"\n               :before-close=\"handleClose\"\n               :visible.sync=\"dialogVisible\"\n               width=\"100%\"\n               fullscreen\n               append-to-body>\n      <el-input v-model=\"textall\"\n                autosize\n                type=\"textarea\"></el-input>\n    </el-dialog>\n  </div>\n</template>\n<script>\nimport { getClient } from \"./upload/ali\";\nimport { getToken } from \"./upload/qiniu\";\nimport { getObjValue, HTMLFormat } from \"./upload/util\";\nimport E from 'wangeditor'\nexport default {\n  name: \"AvueUeditor\",\n  computed: {\n    domId () {\n      return '#' + this.id\n    },\n    imgFlag () {\n      return this.img.url == '';\n    },\n    isImg () {\n      return this.img.obj.src\n    },\n    urlKey () {\n      return this.props.url || 'url';\n    },\n    props () {\n      return this.options.props || {};\n    },\n    oss () {\n      return this.options.oss\n    },\n    customConfig () {\n      return this.options.customConfig || {}\n    },\n    action () {\n      return this.options.action\n    },\n    qiniu () {\n      return this.options.qiniu\n    },\n    ali () {\n      return this.options.ali\n    },\n    isQiniuOSS () {\n      return this.oss === \"qiniu\";\n    },\n    isAliOSS () {\n      return this.oss === \"ali\";\n    },\n    headers () {\n      return this.options.headers || {};\n    }\n  },\n  props: {\n    options: {\n      type: Object,\n      default: () => {\n        return {};\n      }\n    },\n    id: {\n      type: String,\n      default: () => {\n        return 'avue-ueditor-' + Math.ceil(Math.random() * 100)\n      }\n    },\n    disabled: {\n      type: Boolean,\n      default: false\n    },\n    value: {\n      type: String,\n      default: \"\"\n    },\n  },\n  data () {\n    return {\n      textall: '',\n      text: '',\n      dialogVisible: false,\n      editor: ''\n    };\n  },\n  watch: {\n    disabled (val) {\n      this.editor.$textElem.attr('contenteditable', !val)\n    },\n    value (newVal) {\n      if (this.editor) {\n        if (newVal && newVal !== this.text) {\n          this.text = newVal;\n          this.editor.txt.html(newVal);\n        } else if (!newVal) {\n          this.text = '';\n          this.editor.txt.html('');\n        }\n      }\n    },\n  },\n  mounted () {\n    this.initEdit();\n  },\n  methods: {\n    initEdit () {\n      this.editor = new E(this.domId)\n      window.wangEditor = E;\n      this.editor.customConfig.zIndex = 100;\n      this.editor.customConfig.onfocus = () => {\n        this.$emit('focus', this.text)\n      }\n      this.editor.customConfig.onblur = (html) => {\n        this.$emit('blur', html)\n      }\n      this.editor.customConfig.onchange = (html) => {\n        this.text = html;\n        this.$emit('input', this.text)\n      }\n      this.editor.customConfig = Object.assign(this.editor.customConfig, this.customConfig)\n      this.initUploadImg();\n      this.editor.create()\n      this.initPlugins();\n      if (this.disabled) {\n        this.editor.$textElem.attr('contenteditable', false)\n      }\n      this.editor.txt.html(this.value);\n      // 去掉文件粘贴自动上传，如果是复制的网页图片是不会生成两个img标签，粘贴事件不识别是否是网络图片，都会已文件的方式上传，导致bug\n      // this.handlePaste();\n    },\n    initUploadImg () {\n      this.editor.customConfig.customUploadImg = (file, insert) => {\n        this.uploadFile(file[0]).then(res => {\n          insert(res)\n        })\n      }\n    },\n    uploadFile (file) {\n      return new Promise((resolve, reject) => {\n        const loading = this.$loading({\n          lock: true,\n          text: 'Loading',\n          spinner: 'el-icon-loading',\n          background: 'rgba(0, 0, 0, 0.7)',\n          // 只在输入框里面弹起loading，全屏loading很影响用户体验\n          target:`${this.domId}`\n        });\n\n        const headers = Object.assign(this.headers, { \"Content-Type\": \"multipart/form-data\" });\n        let oss_config = {};\n        let client;\n        let param = new FormData();\n        let url = this.action;\n        param.append(\"file\", file);\n        if (this.isQiniuOSS) {\n          oss_config = this.qiniu;\n          const token = getToken(oss_config.AK, oss_config.SK, {\n            scope: oss_config.scope,\n            deadline: new Date().getTime() + oss_config.deadline * 3600\n          });\n          param.append(\"token\", token);\n          url = \"http://up.qiniu.com/\";\n        } else if (this.isAliOSS) {\n          oss_config = this.ali;\n          client = getClient({\n            region: oss_config.region,\n            endpoint: oss_config.endpoint,\n            accessKeyId: oss_config.accessKeyId,\n            accessKeySecret: oss_config.accessKeySecret,\n            bucket: oss_config.bucket\n          });\n        }\n        (() => {\n          if (this.isAliOSS) {\n            return client.put(file.name, file);\n          } else {\n            return this.$axios.post(url, param, { headers });\n          }\n        })().then(res => {\n          let list = {};\n          var result = '';\n          if (this.isAliOSS) {\n            list = res;\n            result = list.url;\n          } else if (this.isQiniuOSS) {\n            list = res.data;\n            list.key = oss_config.url + list.key;\n            result = list.key;\n          } else {\n            list = getObjValue(res.data, this.props.res, \"object\");\n            result = list[this.urlKey];\n          }\n          var html = result\n          loading.close();\n          resolve(html)\n        }).catch(err => {\n          loading.close();\n          reject(err);\n        });\n      })\n\n    },\n    handleClose (done) {\n      this.$emit('input', HTMLFormat(this.textall))\n      done()\n    },\n    getUEContent () {\n      return this.editor.txt.html()\n    },\n    HTMLFormat,\n    handlePaste () {\n      //粘贴键\n      document.addEventListener(\"paste\", e => {\n        //获取剪切板文件\n        const getFile = event => {\n          if (event.clipboardData || event.originalEvent) {\n            var clipboardData =\n              event.clipboardData || event.originalEvent.clipboardData;\n            if (clipboardData.items) {\n              var items = clipboardData.items,\n                len = items.length,\n                blob = null;\n              for (var i = 0; i < len; i++) {\n                if (items[i].type.indexOf(\"image\") !== -1) {\n                  blob = items[i].getAsFile();\n                  return blob;\n                }\n              }\n            }\n          }\n        };\n        const file = getFile(e);\n        if (file) {\n          this.uploadFile(file).then(res => {\n            this.editor.txt.append('<img src=\"' + res + '\" />')\n          })\n        }\n      });\n    },\n    initPlugins () {\n      E.fullscreen = {\n        // editor create之后调用\n        init: function (editorSelector) {\n          setTimeout(() => {\n            document.querySelector(editorSelector + \" .w-e-toolbar\").appendHTML('<div class=\"w-e-menu\"><span class=\"_wangEditor_btn_fullscreen\" href=\"###\" onclick=\"window.wangEditor.fullscreen.toggleFullscreen(\\'' + editorSelector + '\\')\">全屏</span></div>');\n          }, 0);\n        },\n        toggleFullscreen: function (editorSelector) {\n          document.querySelector(editorSelector).toggleClass('fullscreen-editor');\n          if (document.querySelector(editorSelector + ' ._wangEditor_btn_fullscreen').innerText == '全屏') {\n            document.querySelector(editorSelector + ' ._wangEditor_btn_fullscreen').innerText = '退出全屏';\n          } else {\n            document.querySelector(editorSelector + ' ._wangEditor_btn_fullscreen').innerText = '全屏';\n          }\n        }\n      };\n      E.fullscreen.init(this.domId);\n      E.views = {\n        init: function (editorSelector) {\n          document.querySelector(editorSelector + \" .w-e-toolbar\").appendHTML('<div class=\"w-e-menu\"><span class=\"_wangEditor_btn_fullscreen\" href=\"###\" onclick=\"window.wangEditor.views.toggleFullscreen(\\'' + editorSelector + '\\')\">源代码</span></div>');\n        },\n        toggleFullscreen: () => {\n          this.textall = HTMLFormat(this.value);\n          this.dialogVisible = true;\n        }\n      };\n      E.views.init(this.domId);\n    },\n  }\n};\n</script>\n<style lang=\"scss\">\n@import \"../../theme-chack/src/index.scss\";\n</style>\n"],"sourceRoot":"node_modules/avue-plugin-ueditor/packages/ueditor/src"}]}